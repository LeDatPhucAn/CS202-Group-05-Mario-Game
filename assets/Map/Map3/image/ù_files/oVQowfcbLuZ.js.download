;/*FB_PKG_DELIM*/

__d("LSClearPinnedMessages",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(205).fetch([[[a[0]]]]),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxClearPinnedMessagesStoredProcedure";a.__tables__=["msg_pinned_messages_v2"];e.exports=a}),null);
__d("LSCreateOpenToE2EEThreadLink",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.sequence([function(c){return b.db.table(193).put({openThreadId:a[0],armadilloThreadId:a[1],showOpenMessageHistory:a[2],timestampMs:a[3]})},function(a){return c[0]=new b.Map()}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxCreateOpenToE2EEThreadLinkStoredProcedure";a.__tables__=["cutover_threads"];e.exports=a}),null);
__d("MAWDeanonDataCheck",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){var d=b;c||(d=b+1);return a.length>=d}f.hasEnoughDeanonData=a}),66);
__d("MAWFetchEBDeanonMessagesMetadata",["DateConsts","EBFormatUtils","FBLogger","I64","MAWEBDeanonFetch","MAWMessagesDirection","MAWMessagesPaginationUtils","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i=100,j="timeout",k=10*d("DateConsts").MS_PER_SEC;async function a(a){var b=a.chatJid,e=a.direction,f=a.includeReferenceTimestamp,g=a.logger,l=a.range;a=a.sortFn;c("FBLogger")("messenger_web").info("EBMessageRangeDataSource: Issuing fetch request to EB Deanon API");g==null||g.markQPLPoint("eb_fetch_deanon_start");var m=d("MAWMessagesDirection").translateMwpDirectionToMawDirection(e),n=(h||(h=d("I64"))).to_float(d("EBFormatUtils").adjustTs(d("MAWMessagesDirection").getI64RangeTimestampForDirection(e,l),m));e=await d("MAWMessagesPaginationUtils").getRangeExternalIdForDirection(e,l);return Promise.race([d("MAWEBDeanonFetch").fetchMessagesMetadataFromEBDeanon({chatJid:b,count:i,direction:m,includeReferenceTimestamp:f,referenceExternalId:e,referenceTimestampMs:n,sortFn:a}),new Promise(function(a){return window.setTimeout(function(){return a(d("WAResultOrError").makeError(j))},k)})]).then(function(a){g==null||g.markQPLPoint("eb_fetch_deanon_end");return a})}g.fetchEBDeanonMessagesMetadata=a}),98);
__d("MAWFetchDeanonMetadataUsingCache",["I64","MAWDeanonDataCheck","MAWFetchEBDeanonMessagesMetadata","MAWMessagesCompare","MAWMessagesDirection","MAWSubscribeToLSTruncateMetadataThreads","WAJids","WAResultOrError","WATagsLogger","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=d("WATagsLogger").TAGS(["MAWFetchDeanonMetadataUsingCache"]),l=new Map(),m=c("justknobx")._("3763"),n=new Map(),o=null;async function a(a){var b=a.chatJid,c=a.db,e=a.direction,f=a.isFirstPage,g=a.logger,i=a.pageSize,j=a.range;a=a.sortFn;q(c);c=p(b,e,g,j);if(c!=null){g==null||g.addQPLAnnotations({bool:{is_first_page:f},int:{deanon_cached_data_size:c==null?void 0:c.length}});if(d("MAWDeanonDataCheck").hasEnoughDeanonData(c,i,f)){k.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Using cached Deanon messages metadata for comparison to local data"])));g==null||g.addQPLAnnotations({bool:{is_deanon_cached_data_used:!0}});return d("WAResultOrError").makeResult(c)}}i=await d("MAWFetchEBDeanonMessagesMetadata").fetchEBDeanonMessagesMetadata({chatJid:b,direction:e,includeReferenceTimestamp:!f,logger:g,range:j,sortFn:a});i.success===!0&&(g==null||g.addQPLAnnotations({bool:{is_deanon_data_fetched:!0}}),s(b,e,g,i.value,j));return i}function p(a,b,c,e){c==null||c.markQPLPoint("deanon_cache_fetch_start");t(a,b);a=(a=l.get(d("WAJids").threadIdForChatJid(a)))==null?void 0:a.get(b);if(a==null)return null;var f=d("MAWMessagesDirection").getI64RangeTimestampForDirection(b,e);e=(j||(j=d("I64"))).ge(f,a.minTimestampMs)&&(j||(j=d("I64"))).le(f,a.maxTimestampMs);if(!e)return null;e=d("MAWMessagesDirection").switchOnMWPMessagesDirection(b,{asc:a.msgsMetadata.findIndex(function(a){return(j||(j=d("I64"))).ge(j.of_float(a.sortOrderMs),f)}),desc:a.msgsMetadata.findIndex(function(a){return(j||(j=d("I64"))).le(j.of_float(a.sortOrderMs),f)})});b=a.msgsMetadata.slice(e);c==null||c.markQPLPoint("deanon_cache_fetch_end");return b}function q(a){if(o!=null)return;o=d("MAWSubscribeToLSTruncateMetadataThreads").subscribeToLSTruncateMetadataThreads(a,function(a,b){b=(j||(j=d("I64"))).to_string(a);l.delete(b);n.delete(b)})}function r(a,b,c,e){var f;a=d("WAJids").threadIdForChatJid(a);f=(f=l.get(a))!=null?f:new Map();f.set(b,{maxTimestampMs:e.max,minTimestampMs:e.min,msgsMetadata:c});l.set(a,f)}function s(a,b,c,e,f){if(e.length===0)return;c==null||c.markQPLPoint("deanon_cache_replace_start");var g=(j||(j=d("I64"))).of_float(e[e.length-1].sortOrderMs);f=d("MAWMessagesDirection").switchOnMWPMessagesDirection(b,{asc:{max:g,min:f.maxTimestampMs},desc:{max:f.minTimestampMs,min:g}});r(a,b,e,f);c==null||c.markQPLPoint("deanon_cache_replace_end")}function b(a,b){if(b.length===0)return;b=[].concat(b).sort(d("MAWMessagesCompare").getSortComparisonFunctionForDirection("desc"));var c=0,e=b.length-1;while(c<e&&b[c].sortOrderMs===b[c+1].sortOrderMs)c++;if(c===e)return;e=(j||(j=d("I64"))).of_float(b[e].sortOrderMs);n.set(j.to_string(a),{insertTime:Date.now(),minTimestampMs:e,msgsMetadata:b.slice(c)})}function t(a,b){var c=u(a,b);if(c==null)return;k.LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Using init-sync deanon data for ",""])),a);r(a,b,c.msgsMetadata,{max:(j||(j=d("I64"))).max_int,min:c.minTimestampMs});n.delete(d("WAJids").threadIdForChatJid(a))}function u(a,b){if(b!=="desc")return;b=Date.now();a=n.get(d("WAJids").threadIdForChatJid(a));if(a!=null&&b-a.insertTime>m)return;return a}g.MAWFetchDeanonMetadataUsingCache=a;g.fetchDeanonDataFromCache=p;g.initDeanonCacheDescForThread=b}),98);
__d("LSFillDeanonCacheForE2EEThread.nop",["I64","LSShape","LSSynchronousPromise","LSVec","MAWFetchDeanonMetadataUsingCache","PromiseOrValue","ReQL","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a,b,e,f){if(!c("gkx")("15959"))return d("LSSynchronousPromise").makeSynchronousPromise();var g=c("LSVec").toArray(f).map(function(a){a=d("LSShape").toRecord(a);var b=a.offline_threading_id;a=a.sort_order_ms;return{externalId:b,msgType:"unknown-deanon",sortOrderMs:(h||(h=d("I64"))).to_float(a)}});b=d("ReQL").fromTableAscending(a.mi_act_mapping_table).getKeyRange(e).iterator(new WeakMap());return d("LSSynchronousPromise").wrapInSyncPromiseIfNotPromise((i||(i=d("PromiseOrValue"))).map(b.next(),function(a){var b;((b=a.value)==null?void 0:b[1].jid)!=null&&d("MAWFetchDeanonMetadataUsingCache").initDeanonCacheDescForThread(a.value[1].jid,g)}))};a.__nop_name__="LSFillDeanonCacheForE2EEThread";g["default"]=a}),98);
__d("LSFillDeanonCacheForE2EEThread",["LSFillDeanonCacheForE2EEThread.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(d){return c.nativeOperation(b("LSFillDeanonCacheForE2EEThread.nop"),a[0],a[1])},function(a){return c.resolve(d)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxFillDeanonCacheForE2EEThreadStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSShimHybridThreadDeleteByThreadKey.nop",[],(function(a,b,c,d,e,f){"use strict";a=async function(a,b,c){};a.__nop_name__="LSShimHybridThreadDeleteByThreadKey";f.default=a}),66);
__d("LSHybridThreadDelete",["LSShimHybridThreadDeleteByThreadKey.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(d){return c.nativeOperation(b("LSShimHybridThreadDeleteByThreadKey.nop"),a[0])},function(a){return c.resolve(d)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxHybridThreadDeleteStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSIssueCheckBackupStateOnInitSyncTask",["LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSIssueNewEbTaskAndGetTaskIDV2"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[6]=new c.Map(),d[6].set("error_msg","Expected a nonempty query result"),d[6].set("code",c.i64.cast([0,3])),d[6].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[7]=c.createArray(),d[8]=(d[7].push(d[6]),d[7]),e=[void 0,d[7]],d[0]=e[0],d[1]=e[1]):(b=a.item,d[6]=new c.Map(),d[6].set("backup_id",b.backupId),d[6].set("device_public_key_blob",b.devicePublicKeyBlob),d[6].set("device_private_key_blob",b.devicePrivateKeyBlob),d[6].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[6].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[6].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[6].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[6].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[6].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[6].set("orf_client_state_v2_blob",void 0),d[6].set("orf_v2_authority_level",void 0),d[6].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[6].set("device_id",b.deviceId),d[6].set("backup_tenancy",b.backupTenancy),d[6].set("encryption_version",b.encryptionVersion),d[6].set("revision_version",b.revisionVersion),d[6].set("initialize_restore_result",void 0),d[6].set("device_creation_timestamp_sec",void 0),d[6].set("authority_level",b.authorityLevel),e=[d[6],void 0],d[0]=e[0],d[1]=e[1])})},function(a){return d[3]=new c.Map(),d[3].set("value",d[0]),d[3].set("errors",d[1]),d[4]=d[3].get("value"),d[4]!==void 0?c.sequence([function(a){return d[6]=d[4].get("backup_id"),d[7]=d[4].get("device_public_key_blob"),d[8]=d[4].get("device_private_key_blob"),d[9]=d[4].get("epoch_storage_public_key_blob"),d[10]=d[4].get("epoch_storage_private_key_blob"),d[11]=d[4].get("epoch_auth_public_key_blob"),d[12]=d[4].get("epoch_auth_private_key_blob"),d[13]=d[4].get("mailbox_root_key_blob"),d[14]=d[4].get("ocmf_client_state_blob"),d[15]=d[4].get("orf_client_state_v2_blob"),d[16]=d[4].get("orf_v2_authority_level"),d[17]=d[4].get("oblivious_validation_token_blob"),d[18]=d[4].get("device_id"),d[19]=d[4].get("backup_tenancy"),d[20]=d[4].get("encryption_version"),d[21]=d[4].get("revision_version"),d[22]=d[4].get("initialize_restore_result"),d[23]=d[4].get("device_creation_timestamp_sec"),d[24]=d[4].get("authority_level"),c.i64.neq(d[18],void 0)?c.sequence([function(a){return d[26]=void 0,c.i64.neq(d[26],void 0)?c.resolve(d[27]=d[26]):c.sequence([function(a){return d[33]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[34]=a[0],a})},function(a){return d[34]?d[43]=(d[33].push(c.i64.cast([0,0])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[35]?d[43]=(d[33].push(c.i64.cast([0,2])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]?d[43]=(d[33].push(c.i64.cast([0,3])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[37]?d[43]=(d[33].push(c.i64.cast([0,4])),d[33]):0,d[38]=c.createArray(),d[39]=c.i64.of_int32(d[33].length),c.i64.gt(d[39],c.i64.cast([0,0]))?c.loopAsync(d[39],function(a){return d[43]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[33],d[43]).then(function(a){return a=a,d[44]=a[0],d[45]=a[1],a})},function(a){return d[46]=(d[38].push(d[44]),d[38])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[43]=c.createArray(),d[44]=c.i64.of_int32(d[38].length),c.i64.gt(d[44],c.i64.cast([0,0]))?c.loopAsync(d[44],function(a){return d[46]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[38],d[46]).then(function(a){return a=a,d[47]=a[0],d[48]=a[1],a})},function(a){return d[49]=(d[43].push(c.i64.to_string(d[47])),d[43])}])}):c.resolve()},function(a){return d[45]=d[43].join(","),d[40]=d[45]}])},function(a){return d[38].some(function(a){return c.i64.eq(d[20],a)})?d[41]=d[20]:d[41]=void 0,c.i64.neq(d[41],void 0)?d[42]=d[41]:d[42]=void 0,d[27]=d[42]}])},function(a){return c.i64.neq(d[27],void 0)?d[28]=d[27]:d[28]=c.i64.cast([0,0]),c.i64.neq(d[19],void 0)?d[29]=d[19]:d[29]=c.i64.cast([0,1]),d[30]=new c.Map(),d[30].set("backup_id",d[6]),d[30].set("device_id",d[18]),d[31]=c.toJSON(d[30]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",c.i64.cast([0,50054]),d[31],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[25]=!0}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueCheckBackupStateOnInitSyncTaskStoredProcedure] No client state in checkBackupStateOnInitSyncTask with reason: 24"),d[25]=!1))},function(a){return d[5]=d[25]}]):c.resolve((d[6]=d[3].get("errors"),d[7]=d[3].get("errors"),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueCheckBackupStateOnInitSyncTaskStoredProcedure] No client state in checkBackupStateOnInitSyncTask with reason: 1"),d[5]=!1))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueCheckBackupStateOnInitSyncTaskStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSIssueThreadCapabilitySyncTask",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.resolve(c)}a.__sproc_name__="LSMailboxIssueThreadCapabilitySyncTaskStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSMoveThreadToE2EECutoverFolder",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(9).fetch([[[a[0]]]]).next().then(function(c,d){d=c.done;c=c.value;return d?0:(c.item,b.forEach(b.db.table(9).fetch([[[a[0]]]]),function(a){var c=a.update;a.item;return c({folderName:"e2ee_cutover",parentThreadKey:b.i64.cast([-1,4294967279])})}))})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxMoveThreadToE2EECutoverFolderStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSReplaceOptimisticThread",["gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,b=a[a.length-1],d=[],e=[];return b.sequence([function(e){return b.db.table(9).fetch([[[a[1]]]]).next().then(function(e,f){var g=e.done;e=e.value;return g?b.forEach(b.filter(b.db.table(9).fetch([[[a[0]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&b.i64.le(c.authorityLevel,b.i64.cast([0,20]))}),function(c){var d=c.update;c.item;return d({threadKey:a[1],authorityLevel:b.i64.cast([0,40])})}):(f=e.item,b.i64.le(f.authorityLevel,b.i64.cast([0,40]))?(c("gkx")("14697")?d[2]=!1:d[2]=!0,d[1]=d[2]):d[1]=!0,d[1]?b.forEach(b.db.table(9).fetch([[[a[0]]]]),function(a){return a["delete"]()}):b.resolve())})},function(a){return b.resolve(e)}])}a.__sproc_name__="LSMailboxReplaceOptimisticThreadStoredProcedure";a.__tables__=["threads"];b=a;g["default"]=b}),98);
__d("LSSetHMPSStatus",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.resolve(c)}a.__sproc_name__="LSMailboxSetHMPSStatusStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSShimCopyAllParticipantNicknamesForThread",["gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,b=a[a.length-1],d=[];return c("gkx")("26379")===!1?0:0,b.resolve(d)}a.__sproc_name__="LSMailboxShimCopyAllParticipantNicknamesForThreadStoredProcedure";a.__tables__=[];b=a;g["default"]=b}),98);
__d("LSShimGetServerThreadKeyFromJIDV2.nop",["ReQL","RetUtil"],(function(a,b,c,d,e,f,g){"use strict";a=async function(a,b,c){b=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table.index("jid")).getKeyRange(c));return d("RetUtil").getNullableRetResult(b==null?void 0:b.serverThreadKey)};a.__nop_name__="LSShimGetServerThreadKeyFromJIDV2";g.default=a}),98);
__d("WABatcher",["Promise","WAResolvable","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,d){var e=a.delayMs,f=a.maxSize,g=null;function i(a){g&&g.args===a&&(g=null);return d(a)}var j=function(){if(g==null)return(h||(h=b("Promise"))).resolve();var a=g;g=null;clearTimeout(a.timer);a.run();return a.batchPromise};a=function(a){if(g)g.args.push(a);else{var d,k=[a];a=new(h||(h=b("Promise")))(function(a){d=function(){return void a(k)}}).then(i);var l=d;g={args:k,batchPromise:a,run:l,timer:setTimeout(l,e)}}if(g==null)throw c("err")("activeBatch should not be null here");a=g;l=a.args;a=a.batchPromise;var m=l.length-1;f!=null&&l.length>=f&&void j();return a.then(function(a){return a[m]})};return{accept:a,runActiveBatch:j}}function a(a,b){var c=i(a,b);return function(a){return c.accept(a)}}function e(a){var e=[],f=new(d("WAResolvable").Resolvable)(),g=function(c){if(e.length===0)return(h||(h=b("Promise"))).resolve(new Map());var g=e,i=f;e=[];f=new(d("WAResolvable").Resolvable)();return(h||(h=b("Promise"))).resolve(a(g,c)).then(function(a){i.resolve(a);return a})},i=function(a){e.push(a);return f.promise.then(function(b){b=b.get(a);if(b==null)throw c("err")("This should not happen because we just added it to the batch");return b})};return{accept:i,runActiveBatch:g}}g.createSimpleBatcher=i;g.batch=a;g.createBatcher=e}),98);
__d("LSShimVerifyThreadExists.nop",["I64","LSPlatformArmadilloUtils","LSPlatformLsInitLog","MAWBulkCreateOrUpdateThreadInActWithMiData","MAWJids","MAWMIC","MAWThreadLoadingState","MAWThreadMappingQPL","MAWTrackPendingOccamadilloThreads","MWCookieUtil","MWFBLogger","ReQL","WABatcher","getErrorSafe","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=d("MWFBLogger").MWLogger.tags(["MiActMapping","ThreadReady","Occam"]),l=new Map(),m=[];d("LSPlatformArmadilloUtils").executeOnThreadMappingEnd(function(){if(m.length===0)return;var a=m.map(function(a){var b=p(a,"LSShimVerifyThreadExists.init_sync");return babelHelpers.extends({instanceKey:b},a)});o(d("MAWBulkCreateOrUpdateThreadInActWithMiData").bulkCreateOrUpdateThreadInActWithMiData(void 0,a,"init_sync"),a.map(function(a){return a.instanceKey}).filter(Boolean),!0)});a=200;b=20;var n=d("WABatcher").createSimpleBatcher({delayMs:a,maxSize:b},function(a){a=a.map(function(a){var b=p(a,"LSShimVerifyThreadExists.non-init_sync");return babelHelpers.extends({instanceKey:b},a)});o(d("MAWBulkCreateOrUpdateThreadInActWithMiData").bulkCreateOrUpdateThreadInActWithMiData(void 0,a,"batched_mapping"),a.map(function(a){return a.instanceKey}).filter(Boolean),!1);return[]});e=async function(a,b,e,f,g,q,r,s,t,u,v,w,x){d("MAWTrackPendingOccamadilloThreads").markThreadPassedToNativeOp({callingSource:x});b=d("MAWThreadMappingQPL").pendingThreadCreationOnServer.get((j||(j=d("I64"))).to_string(f));g=await Promise.all([d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(e)),d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table).getKeyRange(e))]);q=g[0];u=g[1];v=d("MAWJids").convertIntJidToChatJid(f,r);w=b!=null?b:d("MAWThreadMappingQPL").getInstanceKeyForThreadKey(e);l.set(w,{hasMappingRowAlready:u!=null,isExistingRowPlaceholder:u==null?void 0:(j||(j=d("I64"))).to_float(u.clientThreadPk)<0,isExpectedThreadMissingInLsdb:q==null});u==null&&await d("MAWThreadLoadingState").markActThreadLoadingAsInProgress(a,e,f);k.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Insert MI thread: fbid:",", jid:",", last activity ts:",", last read ts:",", read=",""])),j.to_string(e),j.to_string(f),j.to_string(s),j.to_string(t),String(j.le(s,t)));(j||(j=d("I64"))).equal(s,(j||(j=d("I64"))).zero)&&k.WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["MI thread insertion with lastActivityTimestamp == 0 for lastReadWatermarkTimestampMs: ",""])),(j||(j=d("I64"))).to_string(t));d("MAWTrackPendingOccamadilloThreads").addPendingThread(v);x={description:"LSShimVerifyThreadExists.nop",fbid:e,forceLoadMessages:d("MWCookieUtil").isInChatHead(e),instanceKey:w,isGroupThread:r,jid:f,lastActivityTimestampMs:s,lastReadWatermarkTimestampMs:t};g=d("MWCookieUtil").isAutoChatTabFromCookie(e);g?(p(x,"LSShimVerifyThreadExists.acto"),o(d("MAWBulkCreateOrUpdateThreadInActWithMiData").bulkCreateOrUpdateThreadInActWithMiData(void 0,[x],"acto"),[w],!0)):d("LSPlatformLsInitLog").LsSync.isRunning()?m.push(x):c("promiseDone")(n.accept(x))};f=e;function o(a,b,e){a.catch(function(a){e&&d("MAWMIC").fail("thread_mapping_error",c("getErrorSafe")(a));b.forEach(function(b){return d("MAWThreadMappingQPL").endFailureError(a,b)});return a})}function p(a,b){var c=a.instanceKey!=null?l.get(a.instanceKey):null;c=c==null?null:{hasMappingRowAlready:c.hasMappingRowAlready,hasPlaceholderRowInserted:!c.hasMappingRowAlready,isExistingRowPlaceholder:c.isExistingRowPlaceholder,isExpectedThreadMissingInLsdb:c.isExpectedThreadMissingInLsdb};return d("MAWThreadMappingQPL").startOrContinueForMiActMappingParams(a,b,c)}e.__nop_name__="LSShimVerifyThreadExists";g.default=f}),98);
__d("LSTransportHybridParticipantUpdateReceipts",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.resolve(c)}a.__sproc_name__="LSE2EEMessagingMetadataMailboxTransportHybridParticipantUpdateReceiptsStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTruncateMetadataThreads.nop",["I64","LSIntEnum","ReQL","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=async function(a,b){if(c("gkx")("9855")){b=a.mi_act_mapping_table.keys(new WeakMap());while(!0){var e,f=await b.next();if(f.done)break;await (e=a.mi_act_mapping_table).delete.apply(e,f.value)}e=d("ReQL").fromTableAscending(a.threads).filter(function(a){return a.syncGroup!=null&&(h||(h=d("I64"))).equal(a.syncGroup,(i||(i=d("LSIntEnum"))).ofNumber(95))}).iterator(new WeakMap());while(!0){f=await e.next();if(f.done)break;await (b=a.threads).delete.apply(b,f.value[0])}}return Promise.resolve()};a.__nop_name__="LSTruncateMetadataThreads";g.default=a}),98);
__d("LSTruncateMetadataThreads",["LSTruncateMetadataThreads.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(a){return c.nativeOperation(b("LSTruncateMetadataThreads.nop"))},function(a){return c.resolve(d)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxTruncateMetadataThreadsStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTruncateThreadRangeTablesForSyncGroup",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.sequence([function(c){return b.i64.eq(a[0],b.i64.cast([0,1]))?b.forEach(b.filter(b.db.table(10).fetch(),function(a){return b.i64.eq(b.i64.cast([0,1])==null?b.i64.cast([0,1]):b.i64.cast([0,1]),b.i64.cast([0,1]))}),function(a){return a["delete"]()}):b.i64.eq(a[0],b.i64.cast([0,95]))?b.forEach(b.filter(b.db.table(10).fetch([[[b.i64.cast([0,0])],[b.i64.cast([-1,4294967295])]]]),function(a){return b.i64.eq(b.i64.cast([0,1])==null?b.i64.cast([0,1]):b.i64.cast([0,1]),b.i64.cast([0,1]))&&(b.i64.eq(a.parentThreadKey,b.i64.cast([0,0]))||b.i64.eq(a.parentThreadKey,b.i64.cast([-1,4294967295])))}),function(a){return a["delete"]()}):b.resolve(0)},function(c){return b.i64.eq(a[0],b.i64.cast([0,1]))?b.forEach(b.filter(b.db.table(247).fetch(),function(a){return b.i64.eq(a.syncGroup==null?b.i64.cast([0,1]):a.syncGroup,b.i64.cast([0,1]))}),function(a){return a["delete"]()}):b.resolve()},function(c){return b.forEach(b.db.table(198).fetch([[[a[0]]]]),function(a){return a["delete"]()})},function(c){return b.forEach(b.db.table(220).fetch([[[a[0]]]]),function(a){return a["delete"]()})}])},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxTruncateThreadRangeTablesForSyncGroupStoredProcedure";a.__tables__=["threads_ranges_v2__generated","filtered_threads_ranges_v3__generated","inbox_threads_ranges","sync_group_threads_ranges"];e.exports=a}),null);
__d("LSUpdateOccamadilloMostRecentMessagePerThread",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.db.table(292).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[1]=b.i64.of_float(Date.now()),b.db.table(292).add({threadKey:a[0],timestampMs:a[1],fetchTimestampMs:c[1]})):(e=d.item,c[2]=e.fetchTimestampMs,c[1]=b.i64.of_float(Date.now()),b.i64.neq(c[2],void 0)?b.i64.ge(c[1],b.i64.add(c[2],b.i64.cast([0,2592e6])))?b.db.table(292).put({threadKey:a[0],timestampMs:a[1],fetchTimestampMs:c[1]}):b.resolve():b.forEach(b.db.table(292).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({fetchTimestampMs:c[1]})}))})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxUpdateOccamadilloMostRecentMessagePerThreadStoredProcedure";a.__tables__=["occamadillo_most_recent_message_per_thread"];e.exports=a}),null);
__d("LSUpdateOptimisticContextThreadKeys",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.sequence([function(c){return b.forEach(b.filter(b.db.table(32).fetch(),function(c){return b.i64.eq(c.threadKey,a[0])}),function(b){var c=b.update;b.item;return c({threadKey:a[1]})})},function(c){return b.forEach(b.filter(b.db.table(31).fetch(),function(c){return b.i64.eq(c.threadKey,a[0])}),function(b){var c=b.update;b.item;return c({threadKey:a[1]})})}])},function(a){return b.resolve(c)}])}a.__sproc_name__="LSCoreUpdateOptimisticContextThreadKeysStoredProcedure";a.__tables__=["threads_optimistic_context","messages_optimistic_context"];e.exports=a}),null);
__d("LSUpdateTaskQueueName",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(2).fetch([[[a[0]]],"queueNameTaskId"]),function(b){var c=b.update;b.item;return c({queueName:a[1]})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSCoreUpdateTaskQueueNameStoredProcedure";a.__tables__=["pending_tasks"];e.exports=a}),null);
__d("LSUpdateTaskValue",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(2).fetch([[[a[0]]],"queueNameTaskId"]),function(b){var c=b.update;b=b.item;return c({taskValue:b.taskValue.split(a[1]).join(a[2])})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSCoreUpdateTaskValueStoredProcedure";a.__tables__=["pending_tasks"];e.exports=a}),null);
__d("LSUpdateThreadAuthorityAndMapping",["LSHybridThreadDelete","LSIssueNewTask","LSReplaceOptimisticThread","LSShimGetServerThreadKeyFromJIDV2.nop","LSUpdateOptimisticContextThreadKeys","LSUpdateTaskQueueName","LSUpdateTaskValue"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return c.nativeOperation(b("LSShimGetServerThreadKeyFromJIDV2.nop"),a[0]).then(function(a){return a=a,d[0]=a[0],a})},function(b){return c.db.table(9).fetch([[[a[1]]]]).next().then(function(a,b){b=a.done;a=a.value;return b?d[1]=!1:(a.item,d[1]=!0)})},function(b){return c.filter(c.db.table(9).fetch(),function(b){return c.i64.eq(b.threadKey,a[2])}).next().then(function(a,b){b=a.done;a=a.value;return b?d[3]=!1:(a.item,d[3]=!0)})},function(e){return d[5]=c.i64.neq(d[0],void 0),d[7]=c.i64.eq(d[0],a[2])&&d[5],!d[7]&&!(c.i64.eq(d[0],a[1])&&d[5])&&d[5]?function(a){c.logger(a).mustfix(a)}("The mi_act_mapping row did not correspond to either the authoritative or optimistic thread key."):0,c.i64.neq(a[2],void 0)?d[6]=a[2]:d[6]=c.i64.cast([0,0]),d[5]?d[7]?c.sequence([function(e){return d[1]?c.sequence([function(b){return c.db.table(173).fetch([[[a[1]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[8]=void 0:(b=a.item,d[8]=b.jid)})},function(e){return d[10]=new c.Map(),d[10].set("authoritative_thread_key",a[1]),d[10].set("jid_authoritative_mapped",d[8]),d[10].set("jid_optimistic_mapped",a[0]),d[10].set("optimistic_thread_key",a[2]),d[11]=c.toJSON(d[10]),c.storedProcedure(b("LSIssueNewTask"),"e2ee_log_incorrect_occam_mapping",c.i64.cast([0,160033]),d[11],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(d){return c.storedProcedure(b("LSHybridThreadDelete"),a[1])}]):c.resolve()},function(a){return c.i64.neq(d[6],void 0)?c.forEach(c.db.table(9).fetch([[[d[6]]]]),function(a){var b=a.update;a.item;return b({clientThreadKey:d[6]})}):c.resolve()},function(e){return c.storedProcedure(b("LSReplaceOptimisticThread"),d[6],a[1])},function(e){return c.storedProcedure(b("LSUpdateOptimisticContextThreadKeys"),d[6],a[1])}]):d[3]?c.storedProcedure(b("LSHybridThreadDelete"),d[6]):c.resolve():d[3]?d[1]?c.storedProcedure(b("LSHybridThreadDelete"),d[6]):c.sequence([function(a){return c.i64.neq(d[6],void 0)?c.forEach(c.db.table(9).fetch([[[d[6]]]]),function(a){var b=a.update;a.item;return b({clientThreadKey:d[6]})}):c.resolve()},function(e){return c.storedProcedure(b("LSReplaceOptimisticThread"),d[6],a[1])},function(e){return c.storedProcedure(b("LSUpdateOptimisticContextThreadKeys"),d[6],a[1])}]):c.resolve()},function(e){return d[3]?c.sequence([function(e){return d[9]=c.i64.to_string(d[6]),d[8]=c.i64.to_string(a[1]),c.storedProcedure(b("LSUpdateTaskQueueName"),d[9],d[8])},function(a){return c.storedProcedure(b("LSUpdateTaskValue"),d[8],d[9],d[8])}]):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxUpdateThreadAuthorityAndMappingStoredProcedure";a.__tables__=["threads","mi_act_mapping_table"];e.exports=a}),null);
__d("LSUpdateThreadAuthorityAndMappingWithOTIDFromJID",["LSShimGetServerThreadKeyFromJIDV2.nop","LSUpdateThreadAuthorityAndMapping"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return c.nativeOperation(b("LSShimGetServerThreadKeyFromJIDV2.nop"),a[0]).then(function(a){return a=a,d[0]=a[0],a})},function(e){return c.i64.neq(d[0],a[1])?d[1]=d[0]:d[1]=void 0,c.storedProcedure(b("LSUpdateThreadAuthorityAndMapping"),a[0],a[1],d[1])}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxUpdateThreadAuthorityAndMappingWithOTIDFromJIDStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSUpdateThreadsRangesV2",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.sequence([function(c){return b.forEach(b.db.table(10).fetch([[[a[1]]]]),function(a){return a["delete"]()})},function(d){return c[8]=b.i64.gt(a[2],b.i64.cast([0,1]))&&b.i64.gt(a[3],b.i64.cast([-2147483648,0])),a[0]==="inbox"&&b.i64.eq(a[1],b.i64.cast([0,0]))&&b.i64.eq(a[4],b.i64.cast([0,1]))?b.sequence([function(d){return c[9]=a[2],c[10]=a[3],c[11]=!1,c[12]=c[8],b.forEach(b.db.table(198).fetch(),function(a){a=a.item;return c[13]=a.minLastActivityTimestampMs,c[15]=a.minThreadKey,c[14]=b.i64.lt(c[9]==null?c[13]:c[9],c[13]),c[9]=c[14]?c[13]:c[9],c[10]=c[14]?c[15]:c[10],c[11]=c[11]||a.isLoadingBefore,c[12]=c[12]||b.i64.gt(c[13],b.i64.cast([0,1]))&&b.i64.gt(c[15],b.i64.cast([-2147483648,0]))})},function(a){return a=[c[9],c[10],c[11],c[12]],c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],a}]):b.resolve((d=[a[2],a[3],!1,c[8]],c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],d))},function(d){return b.i64.eq(a[4],b.i64.cast([0,1]))?b.sequence([function(d){return c[9]=c[0],c[10]=c[1],c[11]=c[2],c[12]=c[3],b.forEach(b.filter(b.db.table(220).fetch(),function(c){return b.i64.eq(c.parentThreadKey,a[1])}),function(a){a=a.item;return c[13]=a.minLastActivityTimestampMs,c[15]=a.minThreadKey,c[14]=b.i64.lt(c[9]==null?c[13]:c[9],c[13]),c[9]=c[14]?c[13]:c[9],c[10]=c[14]?c[15]:c[10],c[11]=c[11]||a.isLoadingBefore,c[12]=c[12]||b.i64.gt(c[13],b.i64.cast([0,1]))&&b.i64.gt(c[15],b.i64.cast([-2147483648,0]))})},function(a){return a=[c[9],c[10],c[11],c[12]],c[4]=a[0],c[5]=a[1],c[6]=a[2],c[7]=a[3],a}]):b.resolve((d=[c[0],c[1],c[2],c[3]],c[4]=d[0],c[5]=d[1],c[6]=d[2],c[7]=d[3],d))},function(d){return b.db.table(10).add({parentThreadKey:a[1],minThreadKey:c[5]==null?b.i64.cast([-2147483648,0]):c[5],minLastActivityTimestampMs:c[4]==null?b.i64.cast([0,1]):c[4],maxLastActivityTimestampMs:b.i64.cast([0,1]),maxThreadKey:b.i64.cast([-2147483648,0]),isLoadingBefore:c[6],isLoadingAfter:!1,hasMoreBefore:c[7],hasMoreAfter:!1})}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxUpdateThreadsRangesV2StoredProcedure";a.__tables__=["threads_ranges_v2__generated","inbox_threads_ranges","sync_group_threads_ranges"];e.exports=a}),null);
__d("LSUpsertFolderSeenTimestamp",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.i64.gt(a[1],b.i64.cast([0,0]))?b.db.table(35).fetch([[[a[0]]]]).next().then(function(c,d){var e=c.done;c=c.value;return e?b.db.table(35).add({parentThreadKey:a[0],lastSeenRequestTimestampMs:a[1]}):(d=c.item,b.i64.lt(d.lastSeenRequestTimestampMs,a[1])?b.forEach(b.db.table(35).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({lastSeenRequestTimestampMs:a[1]})}):b.resolve())}):b.resolve()},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpsertFolderSeenTimestampStoredProcedure";a.__tables__=["folder_metadata"];e.exports=a}),null);
__d("LSVerifyHybridThreadExists",["LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSShimVerifyThreadExists.nop","LSVerifyE2EEMetadataThreadExistsV2"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return c.storedProcedure(b("LSVerifyE2EEMetadataThreadExistsV2"),a[2],a[0],c.i64.cast([0,60])).then(function(a){return a=a,d[0]=a[0],a})},function(e){return d[1]=c.i64.of_float(Date.now()),c.i64.neq(a[11],void 0)?c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[10]=new c.Map(),d[10].set("error_msg","Expected a nonempty query result"),d[10].set("code",c.i64.cast([0,3])),d[10].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[11]=c.createArray(),d[12]=(d[11].push(d[10]),d[11]),e=[void 0,d[11]],d[4]=e[0],d[5]=e[1]):(b=a.item,d[10]=new c.Map(),d[10].set("backup_id",b.backupId),d[10].set("device_public_key_blob",b.devicePublicKeyBlob),d[10].set("device_private_key_blob",b.devicePrivateKeyBlob),d[10].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[10].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[10].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[10].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[10].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[10].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[10].set("orf_client_state_v2_blob",void 0),d[10].set("orf_v2_authority_level",void 0),d[10].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[10].set("device_id",b.deviceId),d[10].set("backup_tenancy",b.backupTenancy),d[10].set("encryption_version",b.encryptionVersion),d[10].set("revision_version",b.revisionVersion),d[10].set("initialize_restore_result",void 0),d[10].set("device_creation_timestamp_sec",void 0),d[10].set("authority_level",b.authorityLevel),e=[d[10],void 0],d[4]=e[0],d[5]=e[1])})},function(e){return d[7]=new c.Map(),d[7].set("value",d[4]),d[7].set("errors",d[5]),d[8]=d[7].get("value"),d[8]!==void 0?c.sequence([function(e){return d[10]=d[8].get("backup_id"),d[11]=d[8].get("device_public_key_blob"),d[12]=d[8].get("device_private_key_blob"),d[13]=d[8].get("epoch_storage_public_key_blob"),d[14]=d[8].get("epoch_storage_private_key_blob"),d[15]=d[8].get("epoch_auth_public_key_blob"),d[16]=d[8].get("epoch_auth_private_key_blob"),d[17]=d[8].get("mailbox_root_key_blob"),d[18]=d[8].get("ocmf_client_state_blob"),d[19]=d[8].get("orf_client_state_v2_blob"),d[20]=d[8].get("orf_v2_authority_level"),d[21]=d[8].get("oblivious_validation_token_blob"),d[22]=d[8].get("device_id"),d[23]=d[8].get("backup_tenancy"),d[24]=d[8].get("encryption_version"),d[25]=d[8].get("revision_version"),d[26]=d[8].get("initialize_restore_result"),d[27]=d[8].get("device_creation_timestamp_sec"),d[28]=d[8].get("authority_level"),c.i64.neq(d[22],void 0)?c.sequence([function(a){return d[30]=void 0,c.i64.neq(d[30],void 0)?c.resolve(d[31]=d[30]):c.sequence([function(a){return d[34]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[35]?d[44]=(d[34].push(c.i64.cast([0,0])),d[34]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]?d[44]=(d[34].push(c.i64.cast([0,2])),d[34]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[37]?d[44]=(d[34].push(c.i64.cast([0,3])),d[34]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[38]?d[44]=(d[34].push(c.i64.cast([0,4])),d[34]):0,d[39]=c.createArray(),d[40]=c.i64.of_int32(d[34].length),c.i64.gt(d[40],c.i64.cast([0,0]))?c.loopAsync(d[40],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[34],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=(d[39].push(d[45]),d[39])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[44]=c.createArray(),d[45]=c.i64.of_int32(d[39].length),c.i64.gt(d[45],c.i64.cast([0,0]))?c.loopAsync(d[45],function(a){return d[47]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[39],d[47]).then(function(a){return a=a,d[48]=a[0],d[49]=a[1],a})},function(a){return d[50]=(d[44].push(c.i64.to_string(d[48])),d[44])}])}):c.resolve()},function(a){return d[46]=d[44].join(","),d[41]=d[46]}])},function(a){return d[39].some(function(a){return c.i64.eq(d[24],a)})?d[42]=d[24]:d[42]=void 0,c.i64.neq(d[42],void 0)?d[43]=d[42]:d[43]=void 0,d[31]=d[43]}])},function(b){return c.i64.neq(d[31],void 0)?d[32]=d[31]:d[32]=c.i64.cast([0,0]),c.i64.neq(d[23],void 0)?d[33]=d[23]:d[33]=c.i64.cast([0,1]),d[29]=c.i64.neq(d[22],a[11])}]):c.resolve(d[29]=!1)},function(a){return d[9]=d[29]}]):c.resolve((d[10]=d[7].get("errors"),d[11]=d[7].get("errors"),d[9]=!1))},function(a){return d[2]=d[9]}]):c.resolve(d[2]=!1)},function(e){return d[2]?d[3]=!0:d[3]=a[8],c.nativeOperation(b("LSShimVerifyThreadExists.nop"),a[0],a[1],a[3],a[4],a[5],a[6],a[7],d[3],a[9],a[10],a[12])},function(a){return e[0]=c.i64.cast([0,0])}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxVerifyHybridThreadExistsStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSWriteThreadCapabilities",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.db.table(9).fetch([[[a[0]]]]).next().then(function(d,e){e=d.done;d=d.value;return e?0:(d.item,c[0]=b.i64.of_float(Date.now()),b.forEach(b.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({capabilities:a[1],capabilities2:a[2],capabilities3:a[3],capabilities4:a[4],capabilities5:a[5]})}))})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxWriteThreadCapabilitiesStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);