;/*FB_PKG_DELIM*/

__d("LSInsertAdminMessageInClientMessages.nop",["FBLogger","I64","MAWBridgeFireAndForget","MAWEphemeralMsgAutoResetSystemId","MAWExternalId","MAWJids","MAWMiActOnActThreadReady","MAWMpsGating","WAStanzaUtils","WATimeUtils","base64Binary","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;a=async function(a,b,e,f,g,k,l,m,n){m!=null&&n!=null?await d("MAWMiActOnActThreadReady").onActThreadReady(a,e,"LSInsertAdminMessageInClientMessages_"+g,function(a,b){d("MAWBridgeFireAndForget").fireAndForget("mps","mpsHandleLsAdminMessage",{actorFbid:(h||(h=d("I64"))).to_string(f),chatJid:b,externalId:m,protobuf:d("base64Binary").decode(n).buffer,timestampMs:h.to_float(k)});return Promise.resolve()}):c("FBLogger")("mps").warn("admin message %s cannot be processed",g);if(d("MAWMpsGating").isFullMpsEnabled()||c("gkx")("3049"))return Promise.resolve();var o=m!=null?d("WAStanzaUtils").toStanzaId(m):d("MAWExternalId").generateExternalId();if(g==="change_thread_theme"){var p=l.has("theme_emoji")?i(l.get("theme_emoji")):void 0,q=l.has("theme_name_with_subtitle")?i(l.get("theme_name_with_subtitle")):void 0;if(q==null){c("FBLogger")("messenger_web").mustfix("invalid themeNameWithSubtitle when writing admin message for thread theme customization");return Promise.resolve()}var r=l.has("theme_type")?i(l.get("theme_type")):void 0;r==null&&c("FBLogger")("messenger_web").warn("invalid themeType when writing admin message for thread theme customization");return d("MAWMiActOnActThreadReady").onActThreadReady(a,e,"LSInsertAdminMessageInClientMessages_"+g,function(a,b){d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForThreadThemeCustomization",{actorFbid:(h||(h=d("I64"))).to_string(f),chatJid:b,externalId:o,serverAuthoritativeTimestampMs:d("WATimeUtils").castToMillisTime(h.to_float(k)),themeEmoji:p,themeNameWithSubtitle:q,themeType:r});return Promise.resolve()})}else if(g==="change_thread_image")return d("MAWMiActOnActThreadReady").onActThreadReady(a,e,"LSInsertAdminMessageInClientMessages_"+g,function(a,b){d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForThreadPhotoCustomization",{actorFbid:(h||(h=d("I64"))).to_string(f),chatJid:b,externalId:o,serverAuthoritativeTimestampMs:d("WATimeUtils").castToMillisTime(h.to_float(k))});return Promise.resolve()});else if(g==="link_cta"){var s=l.has("initiator_user_id")?i(l.get("initiator_user_id")):void 0;if(s==null){c("FBLogger")("messenger_web").mustfix("UK OSA Link CTA should have valid initiator user id with the message.");return Promise.resolve()}return d("MAWMiActOnActThreadReady").onActThreadReady(a,e,"LSInsertAdminMessageInClientMessages_"+g,function(a,b){c("gkx")("9653")&&d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForUKOSA",{actorFbid:s,chatJid:b,externalId:o,serverAuthoritativeTimestampMs:d("WATimeUtils").castToMillisTime((h||(h=d("I64"))).to_float(k))});return Promise.resolve()})}else if(g==="pin_messages_v2")return d("MAWMiActOnActThreadReady").onActThreadReady(a,e,"LSInsertAdminMessageInClientMessages_"+g,function(a,b){d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForPinMessage",{actorFbid:(h||(h=d("I64"))).to_string(f),chatJid:b,externalId:o,serverAuthoritativeTimestampMs:d("WATimeUtils").castToMillisTime(h.to_float(k))});return Promise.resolve()});else if(g==="unpin_messages_v2")return d("MAWMiActOnActThreadReady").onActThreadReady(a,e,"LSInsertAdminMessageInClientMessages_"+g,function(a,b){d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForUnpinMessage",{actorFbid:(h||(h=d("I64"))).to_string(f),chatJid:b,externalId:o,serverAuthoritativeTimestampMs:d("WATimeUtils").castToMillisTime(h.to_float(k))});return Promise.resolve()});else if(g==="change_thread_icon"){var t=l.has("thread_icon")?i(l.get("thread_icon")):void 0;if(t==null){c("FBLogger")("messenger_web").mustfix("invalid thread_icon when writing admin message for thread hotlike customization");return Promise.resolve()}return d("MAWMiActOnActThreadReady").onActThreadReady(a,e,"LSInsertAdminMessageInClientMessages_"+g,function(a,b){d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForThreadHotlikeCustomization",{actorFbid:(h||(h=d("I64"))).to_string(f),chatJid:b,externalId:o,serverAuthoritativeTimestampMs:d("WATimeUtils").castToMillisTime(h.to_float(k)),threadIcon:t.length===0?"\ud83d\udc4d":t});return Promise.resolve()})}else if(g==="change_thread_quick_reaction"){var u=l.has("thread_quick_reaction_emoji")?i(l.get("thread_quick_reaction_emoji")):void 0;if(u==null){c("FBLogger")("messenger_web").mustfix("invalid reaction when writing admin message for thread quick reaction customization");return Promise.resolve()}return d("MAWMiActOnActThreadReady").onActThreadReady(a,e,"LSInsertAdminMessageInClientMessages_"+g,function(a,b){d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForThreadHotlikeCustomization",{actorFbid:(h||(h=d("I64"))).to_string(f),chatJid:b,externalId:o,serverAuthoritativeTimestampMs:d("WATimeUtils").castToMillisTime(h.to_float(k)),threadIcon:u.length===0?"\ud83d\udc4d":u});return Promise.resolve()})}else if(g==="change_thread_nickname"){var v=l.has("participant_id")?i(l.get("participant_id")):void 0,w=l.has("nickname")?i(l.get("nickname")):void 0;if(v==null||w==null){c("FBLogger")("messenger_web").mustfix("invalid params when writing admin message for thread nickname customization");return Promise.resolve()}return d("MAWMiActOnActThreadReady").onActThreadReady(a,e,"LSInsertAdminMessageInClientMessages_"+g,function(a,b){d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForThreadNicknameCustomization",{actorFbid:(h||(h=d("I64"))).to_string(f),chatJid:b,externalId:o,nickName:w,participantId:v,serverAuthoritativeTimestampMs:d("WATimeUtils").castToMillisTime(h.to_float(k))});return Promise.resolve()})}else if(g==="change_disappearing_setting")return d("MAWMiActOnActThreadReady").onActThreadReady(a,e,"LSInsertAdminMessageInClientMessages_"+g,function(a,b){a=l.has("disappearing_setting_time")?i(l.get("disappearing_setting_time")):void 0;var e=l.has("old_disappearing_setting_time")?i(l.get("old_disappearing_setting_time")):void 0,f=l.has("disappearing_setting_actor_fbid")?i(l.get("disappearing_setting_actor_fbid")):void 0,g=l.has("disappearing_setting_is_initial_sync")?j(l.get("disappearing_setting_is_initial_sync"))===!0:!1;a==null&&c("FBLogger")("messenger_web").mustfix("[labyrinth][web] settingsTtl missing for admin msg, isInitSync: %s",g.toString());var m=f===c("MAWEphemeralMsgAutoResetSystemId"),n=parseInt(a,10);f==null&&g&&c("FBLogger")("messenger_web").info("[labyrinth][web] author for ephemeral admin msg is null, ttl is zero: %s",(n===0).toString());if(g)return Promise.resolve();if(g||m){d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForEphemeralSettingsChange",{author:null,chatJid:b,expirationInSec:n,externalId:o,isEphemeralSettingReset:m,isInitSync:g,isTurningOnEphemeralSetting:g,serverTs:d("WATimeUtils").castToUnixTime((h||(h=d("I64"))).to_float(k)/1e3)});return Promise.resolve()}else f!=null&&a!=null?d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForEphemeralSettingsChange",{author:d("MAWJids").toUserJid(f),chatJid:b,expirationInSec:n,externalId:o,isEphemeralSettingReset:!1,isInitSync:!1,isTurningOnEphemeralSetting:e==null||e==="0",serverTs:d("WATimeUtils").castToUnixTime((h||(h=d("I64"))).to_float(k)/1e3)}):c("FBLogger")("messenger_web").mustfix("[labyrinth][web] param missing for admin msg, author: %s, settingsTtl: %s, oldSettingsTtl: %s, isInitSync: %s",(f!=null).toString(),(a!=null).toString(),(e!=null).toString(),g.toString());return Promise.resolve()});else if(g==="limit_sharing"){b=l.has("limit_sharing_type")?i(l.get("limit_sharing_type")):void 0;var x=b==="enabled";return d("MAWMiActOnActThreadReady").onActThreadReady(a,e,"LSInsertAdminMessageInClientMessages.nop",function(a,b){d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForLimitSharing",{actorFbid:(h||(h=d("I64"))).to_string(f),chatJid:b,externalId:o,isLimitSharingEnabled:x,serverAuthoritativeTimestampMs:d("WATimeUtils").castToMillisTime(h.to_float(k))});return Promise.resolve()})}return Promise.resolve()};var i=function(a){if(a==null)return void 0;if(typeof a==="string")return a;c("FBLogger")("messenger_web").mustfix("Invalid type for string, expected string, but got %s",typeof a);return void 0},j=function(a){if(typeof a==="boolean")return a;c("FBLogger")("messenger_web").mustfix("Invalid type for boolean, expected boolean, but got %s",typeof a);return void 0};a.__nop_name__="LSInsertAdminMessageInClientMessages";g.default=a}),98);
__d("LSInsertAdminMessageInClientMessages",["LSInsertAdminMessageInClientMessages.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(d){return c.nativeOperation(b("LSInsertAdminMessageInClientMessages.nop"),a[0],a[1],a[2],a[3],a[4],a[5],a[6])},function(a){return c.resolve(d)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxInsertAdminMessageInClientMessagesStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSUpdateDisappearingSettingInClientThreadsTable.nop",["I64","LSMessagingThreadAttributionType","MAWBridgeFireAndForget","MAWBridgeSendAndReceive","MAWCurrentUser","MAWEphemeralMsgAutoResetSystemId","MAWJids","MAWMessageSendReporter","MAWMiActOnActThreadReady","ReQL","WATimeUtils","promiseDone","qpl","sendToSentQPLLogger"],(function(a,b,c,d,e,f,g){"use strict";var h;a=async function(a,b,e){var f=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(e));if(f!=null)return d("MAWMiActOnActThreadReady").onActThreadReady(a,e,"LSUpdateDisappearingSettingInClientThreadsTable.nop",function(a,b){var e={ephemeralExpirationInSec:(h||(h=d("I64"))).to_int32((a=f.disappearingSettingTtl)!=null?a:(h||(h=d("I64"))).zero),ephemeralLastUpdatedOrSetTimestamp:d("WATimeUtils").castMilliSecondsToUnixTime(h.to_float((a=f.disappearingSettingUpdatedTs)!=null?a:(h||(h=d("I64"))).zero))};d("MAWBridgeFireAndForget").fireAndForget("backend","setEphemeralSettingCache",{jid:b,settings:e});if(f.disappearingSettingUpdatedBy!=null){a=(h||(h=d("I64"))).to_string(f.disappearingSettingUpdatedBy);var g=a===c("MAWEphemeralMsgAutoResetSystemId");if(a===d("MAWCurrentUser").getID()||g){var i=function(a){return d("MAWBridgeSendAndReceive").sendAndReceive("backend","setEphemeralSettingsFromFrontend",{chatJid:b,ephemeralExpirationInSec:e.ephemeralExpirationInSec,ephemeralLastUpdatedOrSetTimestamp:e.ephemeralLastUpdatedOrSetTimestamp,isEphemeralSettingReset:g,s2sInstanceKey:a})},j=d("sendToSentQPLLogger").markSendToSentStartWithAnnotation(f,{isEphemeralSetting:!0},c("LSMessagingThreadAttributionType").UNKNOWN);c("promiseDone")(d("MAWMessageSendReporter").MAWMessageSendReporter(null,i(j),{qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:j}))}else d("MAWBridgeFireAndForget").fireAndForget("backend","setEphemeralSettingsFromMI",{author:d("MAWJids").toUserJid(a),chatJid:b,ephemeralExpirationInSec:e.ephemeralExpirationInSec,ephemeralLastUpdatedOrSetTimestamp:e.ephemeralLastUpdatedOrSetTimestamp,fromWAI:!1,isEphemeralSettingReset:!1,serverTs:e.ephemeralLastUpdatedOrSetTimestamp})}return Promise.resolve()})};a.__nop_name__="LSInsertAdminMessageInClientMessages";g.default=a}),98);
__d("LSUpdateDisappearingSettingInClientThreadsTable",["LSUpdateDisappearingSettingInClientThreadsTable.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(d){return c.nativeOperation(b("LSUpdateDisappearingSettingInClientThreadsTable.nop"),a[0])},function(a){return c.resolve(d)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxUpdateDisappearingSettingInClientThreadsTableStoredProcedure";a.__tables__=[];e.exports=a}),null);