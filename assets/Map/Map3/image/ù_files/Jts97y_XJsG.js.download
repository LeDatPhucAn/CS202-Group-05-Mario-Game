;/*FB_PKG_DELIM*/

__d("LSHandleMediaReceiverFetchResult.nop",["I64","LSIntEnum","MAWBridgeFireAndForget","MAWBridgeUpdateClientMediaStatusHandler","MAWImageUtils","MAWMediaDownloadStatus","MWFBLogger","MessagingAttachmentType","ReQL","WAHashUtils","WALongInt","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=d("MWFBLogger").MWMediaLogger.tags(["HandleMediaReceiverFetchResult"]);function n(a){switch(a){case(k||(k=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").STICKER):return"sticker";default:m.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["\n        Unsupported type "," for MAWBridgeNewReceiverFetchInfoHandler\n      "])),(k||(k=d("LSIntEnum"))).toNumber(a))}}a=async function(a,b,e,f,g,h,k,o,p,q,r,s){b=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.attachments).getKeyRange(f,g));if(b==null||b.receiverFetchId==null||b.receiverFetchId!==e){await d("MAWBridgeUpdateClientMediaStatusHandler").txnHandler(a,{details:"issue_receiver_fetch_task_callback",key:d("WAHashUtils").stringToPlaintextHash(g),status:c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE,type:"main"});m.MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Not a receiver fetch attachment from LSHandleMediaReceiverFetchResult.nop"])));return}r=d("MAWImageUtils").boundHeightWidth((l||(l=d("I64"))).to_int32(q),l.to_int32(p),d("MAWImageUtils").STICKER_THUMBNAIL_MAX_SIZE);f=r.height;r=r.width;await a.attachments.put(babelHelpers.extends({},b,{accessibilitySummaryText:s!=null?s:void 0,hasMedia:!0,previewHeight:l.of_int32(f),previewUrl:h,previewUrlExpirationTimestampMs:k,previewUrlMimeType:o,previewWidth:l.of_int32(r)}));await d("MAWBridgeUpdateClientMediaStatusHandler").txnHandler(a,{details:"issue_receiver_fetch_task_callback",key:d("WAHashUtils").stringToPlaintextHash(g),status:c("MAWMediaDownloadStatus").SUCCESS,type:"main"});try{f=(l||(l=d("I64"))).to_string(k);r=d("WALongInt").decimalStringToLongInt(f);a=b!=null?n(b.attachmentType):void 0;d("MAWBridgeFireAndForget").fireAndForget("backend","updateReceiverFetchInfo",{accessibilitySummaryText:s,mimetype:o,previewHeight:l.to_int32(q),previewUrl:h,previewUrlExpirationTimestampMs:r,previewWidth:l.to_int32(p),receiverFetchId:e,type:a})}catch(a){m.MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Failed to cast previewUrlExpirationTimestampMs to long int: ",""])),c("getErrorSafe")(a).toString())}};a.__nop_name__="LSHandleMediaReceiverFetchResult";g.default=a}),98);